<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mango Market App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0d0216; --accent: #ff003c; --violet: #7000ff; --card-bg: rgba(255, 255, 255, 0.07); }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: radial-gradient(circle at top right, #300030, #0d0216); min-height: 100vh; overflow-x: hidden; }
        .app-container { padding: 20px; padding-bottom: 100px; }
        .card { background: var(--card-bg); border: 1px solid rgba(255, 0, 60, 0.3); border-radius: 18px; padding: 15px; margin-bottom: 15px; backdrop-filter: blur(10px); }
        h2 { color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }
        .btn { background: linear-gradient(45deg, var(--accent), var(--violet)); border: none; color: white; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(13, 2, 22, 0.9); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid var(--violet); z-index: 1000; }
        .nav-item { opacity: 0.5; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .nav-item.active { opacity: 1; color: var(--accent); text-shadow: 0 0 10px var(--accent); }
        .hidden { display: none; }
        .pack-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input { width: 90%; padding: 10px; margin: 10px 0; background: rgba(0,0,0,0.5); border: 1px solid var(--violet); border-radius: 8px; color: white; }
        .wheel-box { text-align: center; }
        .wheel { width: 220px; height: 220px; border-radius: 50%; border: 5px solid var(--accent); margin: 0 auto; background: conic-gradient(#ff003c, #7000ff, #ff003c, #7000ff); transition: 4s cubic-bezier(0.1, 0, 0, 1); box-shadow: 0 0 20px var(--violet); }
    </style>
</head>
<body>

<div class="app-container">
    <div id="market-page">
        <h2 data-key="market_title">üõç Market</h2>
        
        <div class="pack-grid" id="cat-select">
            <button class="btn" onclick="openSub('stars-menu')">‚≠ê Stars</button>
            <button class="btn" onclick="openSub('prem-menu')">üíé Premium</button>
        </div>

        <div id="stars-menu" class="hidden">
            <button class="btn" style="background:none; border:1px solid grey;" onclick="openSub('cat-select')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="pack-grid" style="margin-top:10px;">
                <div class="card"><h3>100 ‚≠ê</h3><p>110‚Ç¥</p><button class="btn" onclick="buy('100 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
                <div class="card"><h3>250 ‚≠ê</h3><p>260‚Ç¥</p><button class="btn" onclick="buy('250 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
                <div class="card"><h3>500 ‚≠ê</h3><p>510‚Ç¥</p><button class="btn" onclick="buy('500 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
                <div class="card"><h3>1000 ‚≠ê</h3><p>980‚Ç¥</p><button class="btn" onclick="buy('1000 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
                <div class="card"><h3>5000 ‚≠ê</h3><p>4700‚Ç¥</p><button class="btn" onclick="buy('5000 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
                <div class="card"><h3>10–∫ ‚≠ê</h3><p>9200‚Ç¥</p><button class="btn" onclick="buy('10000 Stars')">–ö—É–ø–∏—Ç–∏</button></div>
            </div>
        </div>

        <div id="prem-menu" class="hidden">
            <button class="btn" style="background:none; border:1px solid grey;" onclick="openSub('cat-select')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card" style="margin-top:10px;">
                <h3>Telegram Premium</h3>
                <button class="btn" onclick="buy('Prem Login')">üîê –ß–µ—Ä–µ–∑ –≤—Ö—ñ–¥ (–¥–µ—à–µ–≤—à–µ)</button>
                <button class="btn" style="margin-top:10px;" onclick="buy('Prem Gift')">üéÅ –ü–æ–¥–∞—Ä—É–Ω–∫–æ–º (Gift)</button>
            </div>
        </div>
    </div>

    <div id="wheel-page" class="hidden">
        <h2 data-key="wheel_title">üé° Fortune Wheel</h2>
        <div class="wheel-box">
            <div class="wheel" id="wheel"></div>
            <p style="margin-top:20px;"><span data-key="cost_text">–í–∞—Ä—Ç—ñ—Å—Ç—å</span>: 50‚Ç¥</p>
            <button class="btn" onclick="spin()" data-key="spin_btn">–ö—Ä—É—Ç–∏—Ç–∏ üî•</button>
        </div>
    </div>

    <div id="profile-page" class="hidden">
        <h2 data-key="profile_title">üë§ Profile</h2>
        <div class="card">
            <input type="email" id="reg-email" placeholder="Email –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó">
            <button class="btn" onclick="regMail()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ—à—Ç—É</button>
        </div>
        <div class="card">
            <p>Email: <span id="user-email">–Ω–µ –≤–∫–∞–∑–∞–Ω–æ</span></p>
            <p><span data-key="balance">–ë–∞–ª–∞–Ω—Å</span>: <b id="balance">0.00</b> TON</p>
        </div>
        <div class="card">
            <p style="color:#ffcc00; font-size:12px;">‚ö†Ô∏è –Ø–∫—â–æ –Ω–µ –ø–æ–∫—Ä–∏—Ç–∏ –∫–æ–º—ñ—Å—ñ—é –º–µ—Ä–µ–∂—ñ, –ø–ª–∞—Ç—ñ–∂ –Ω–µ –±—É–¥–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ!</p>
            <input type="number" id="topup-ton" placeholder="–°—É–º–∞ –≤ TON">
            <button class="btn" onclick="payTon()" data-key="topup">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ TON</button>
            <p id="payment-id-display" style="font-size: 14px; margin-top: 10px; color: #ff003c; font-weight:bold;"></p>
        </div>
    </div>
</div>

<nav class="nav">
    <div class="nav-item active" id="nav-market" onclick="showPage('market', this)">–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="nav-item" id="nav-wheel" onclick="showPage('wheel', this)">üé° –£–¥–∞—á—É</div>
    <div class="nav-item" id="nav-profile" onclick="showPage('profile', this)">–ü—Ä–æ—Ñ—ñ–ª—å</div>
</nav>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    function showPage(page, el) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('market-page').classList.add('hidden');
        document.getElementById('wheel-page').classList.add('hidden');
        document.getElementById('profile-page').classList.add('hidden');
        document.getElementById(page + '-page').classList.remove('hidden');
    }

    function openSub(id) {
        document.getElementById('cat-select').classList.add('hidden');
        document.getElementById('stars-menu').classList.add('hidden');
        document.getElementById('prem-menu').classList.add('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    function buy(item) {
        tg.sendData(JSON.stringify({action: "buy_request", item: item}));
    }

    function regMail() {
        let email = document.getElementById('reg-email').value;
        if(!email.includes('@')) return alert("–ù–µ–≤—ñ—Ä–Ω–∏–π email");
        tg.sendData(JSON.stringify({action: "reg_email", email: email}));
    }

    function payTon() {
        let amount = document.getElementById('topup-ton').value;
        if(!amount || amount <= 0) return alert("–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É TON");
        let payId = Math.floor(1000 + Math.random() * 9000);
        let wallet = "UQCeajMf5dLZba5lM1Fs8RsPSG26PoomRxINUTnKzJZhLTKg";
        let link = `ton://transfer/${wallet}?amount=${amount * 1000000000}&text=${payId}`;
        document.getElementById('payment-id-display').innerHTML = `–í–ê–® ID: ${payId} (–í–ö–ê–ñ–Ü–¢–¨ –í –ö–û–ú–ï–ù–¢–ê–†)`;
        window.open(link, '_blank');
        tg.sendData(JSON.stringify({action: "payment_start", id: payId, sum: amount}));
    }

    function spin() {
        let w = document.getElementById('wheel');
        let deg = Math.floor(3000 + Math.random() * 5000);
        w.style.transform = `rotate(${deg}deg)`;
        
        setTimeout(() => {
            let rnd = Math.random() * 100;
            let result = "–ù—ñ—á–æ–≥–æ";
            if (rnd < 15) result = "100 Stars";
            else if (rnd < 25) result = "150 Stars";
            
            alert("–†–µ–∑—É–ª—å—Ç–∞—Ç: " + result);
            tg.sendData(JSON.stringify({action: "wheel_result", win: result}));
        }, 4100);
    }
</script>
</body>
</html>
